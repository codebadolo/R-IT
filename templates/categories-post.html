{% extends "baseFiles/base.html" %}
{% load static %}

{% block bodycontent %}
<section class="trending-product-area light-bg-s pt-25 pb-15">
  <div class="container custom-container">
    {% include 'baseFiles/messages.html' %}
    <div class="row">
      <div class="col-xl-12">
        <div class="section__head d-flex justify-content-between mb-30">
          {% if products %}
            <div class="section__title section__title-2">
              <h5 class="st-titile">Showing Products in {{ products.first.categories.name }}</h5>
            </div>
          {% else %}
            <div class="section__title section__title-2">
              <h5 class="st-titile">No Products Found</h5>
            </div>
          {% endif %}
          <div class="button-wrap button-wrap-2">
            <a href="{% url 'home' %}">
              See All Products <i class="fal fa-chevron-right"></i>
            </a>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <!-- Sidebar for Filters -->
      <div class="col-lg-3">
        <div class="filter-section mb-30">
          <form method="get" class="filter-form">
            <!-- Search Field -->
            <div class="mb-3">
              <input
                type="text"
                name="q"
                placeholder="Search products"
                value="{{ request.GET.q }}"
                class="form-control"
              />
            </div>
            <!-- Price Range -->
            <div class="mb-3">
              <label for="min_price">Min Price:</label>
              <input
                type="number"
                name="min_price"
                id="min_price"
                placeholder="Min price"
                value="{{ request.GET.min_price }}"
                class="form-control"
              />
            </div>
            <div class="mb-3">
              <label for="max_price">Max Price:</label>
              <input
                type="number"
                name="max_price"
                id="max_price"
                placeholder="Max price"
                value="{{ request.GET.max_price }}"
                class="form-control"
              />
            </div>
            <!-- Attributes Section -->
            <h5>Filter by Attributes</h5>
            {% for attribute in attributes %}
              <div class="mb-3">
                <strong>{{ attribute.name }}</strong>
                <div class="d-flex flex-wrap">
                  {% for value in attribute.attributevalue_set.all %}
                    <div class="form-check me-3">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        name="attribute"
                        value="{{ value.id }}"
                        id="attr-{{ value.id }}"
                        {% if value.id|stringformat:"s" in selected_attributes %}
                        checked{% endif %}
                      />
                      <label class="form-check-label" for="attr-{{ value.id }}">
                        {{ value.value }}
                      </label>
                    </div>
                  {% empty %}
                    <div>No attribute values available.</div>
                  {% endfor %}
                </div>
              </div>
            {% endfor %}
            <!-- Submit Button -->
            <button type="submit" class="btn btn-primary w-100">Filter</button>
          </form>
        </div>
      </div>

      <!-- Main Content for Products -->
      <div class="col-lg-9">
        <div class="row">
          {% if products %}
            {% for product in products %}
              <div class="col-sm-6 col-md-4 col-lg-3 col-xl-3 col-xxl-2">
                <div class="product__item product__item-2 b-radius-2 mb-20">
                  <div class="product__thumb fix">
                    <div class="product-image w-img">
                      <a href="{% url 'product_details' product.slug %}">
                        <img
                          src="{{ product.productimage_set.first.image|default:'/path/to/default-image.jpg' }}"
                          alt="{{ product.title }}"
                        />
                      </a>
                    </div>
                    {% if product.discounted_price %}
                      <div class="product__offer">
                        <span class="discount">-{{ product.discounted_price }}%</span>
                      </div>
                    {% endif %}
                    <div class="product-action product-action-2">
                      <a href="#" class="icon-box icon-box-1" data-bs-toggle="modal" data-bs-target="#productModalId">
                        <i class="fal fa-eye"></i>
                      </a>
                      <a href="#" class="icon-box icon-box-1">
                        <i class="fal fa-heart"></i>
                      </a>
                      <a href="#" class="icon-box icon-box-1">
                        <i class="fal fa-layer-group"></i>
                      </a>
                    </div>
                  </div>
                  <div class="product__content product__content-2">
                    <h6>
                      <a href="{% url 'product_details' product.slug %}">
                        {{ product.title|truncatewords:5 }}
                      </a>
                    </h6>
                    <div class="rating mb-5 mt-10">
                      <ul>
                        <li><a href="#"><i class="fal fa-star"></i></a></li>
                        <li><a href="#"><i class="fal fa-star"></i></a></li>
                        <li><a href="#"><i class="fal fa-star"></i></a></li>
                        <li><a href="#"><i class="fal fa-star"></i></a></li>
                        <li><a href="#"><i class="fal fa-star"></i></a></li>
                      </ul>
                      <span>(01 review)</span>
                    </div>
                    <div class="price">
                      <span>${{ product.regular_price }}</span>
                    </div>
                  </div>
                  <div class="product__add-cart text-center">
                    <button type="button" class="cart-btn-3 product-modal-sidebar-open-btn d-flex align-items-center justify-content-center w-100">
                      Add to Cart
                    </button>
                  </div>
                </div>
              </div>
            {% endfor %}
          {% else %}
            <div class="col-12">
              <p>No products available in this category with the selected filters.</p>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock bodycontent %}
